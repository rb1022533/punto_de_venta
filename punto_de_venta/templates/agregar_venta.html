{% extends 'base.html' %}
{% load static %}

{% block content %}
<h2>Registrar Venta</h2>

<form method="POST" id="venta-form">
  {% csrf_token %}

  <!-- Datos del cliente -->
  {{ venta_form.as_p }}

  <!-- Sección para agregar productos -->
  <h3>Agregar productos</h3>
  <div>
    <select id="producto-input" style="width: 300px;">
      <option value="" disabled selected>Selecciona un producto</option>
      {% for producto in productos %}
        {% if producto.cantidad_stock > 0 %}
          <option value="{{ producto.id }}" data-precio="{{ producto.precio_venta }}" data-stock="{{ producto.cantidad_stock }}">
            {{ producto.nombre }}
          </option>
        {% endif %}
      {% endfor %}
    </select>

    <input type="number" id="cantidad-input" placeholder="Cantidad" min="1" style="width:100px;">
    <button type="button" id="add-producto">Agregar</button>
  </div>

  <!-- Lista de productos agregados -->
  <h3>Lista de productos</h3>
  <table id="productos-table" border="1" style="border-collapse: collapse; width: 100%;">
    <thead>
      <tr>
        <th>Producto</th>
        <th>Cantidad</th>
        <th>Precio Unitario</th>
        <th>Subtotal</th>
        <th>Acción</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <!-- Campos ocultos que enviarán productos[] y cantidades[] -->
  <div id="hidden-fields"></div>

  <br>
  <button type="submit">Guardar Venta</button>
</form>

<a href="{% url 'lista_ventas' %}">Cancelar</a>

<!-- Select2 -->
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<script src="{% static 'js/agregar_venta.js' %}"></script>
{% endblock %}