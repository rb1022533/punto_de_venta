{% extends 'base.html' %}
{% load static %}

{% block content %}

<!-- Botones al inicio -->
<div>
  <button type="submit" form="venta-form">Guardar Venta</button>
  <a href="{% url 'inicio' %}">Cancelar</a>
</div>

<h2>Registrar Venta</h2>

<form method="POST" id="venta-form">
  {% csrf_token %}

  <!-- Datos del cliente -->
  {{ venta_form.as_p }}

  <!-- Sección para agregar productos -->
  <h3>Agregar productos</h3>
  <div>
    <select id="producto-input" style="width: 300px;">
      <option value="" disabled selected>Selecciona un producto</option>
      {% for producto in productos %}
        {% if producto.cantidad_stock > 0 %}
          <option value="{{ producto.id }}" data-precio="{{ producto.precio_venta }}" data-stock="{{ producto.cantidad_stock }}">
            {{ producto.nombre }}
          </option>
        {% endif %}
      {% endfor %}
    </select>

    <input type="number" id="cantidad-input" placeholder="Cantidad" min="1">
    <button type="button" id="add-producto">Agregar</button>
  </div>

  <!-- Lista de productos agregados -->
  <h3>Lista de productos</h3>
  <table id="productos-table">
    <thead>
      <tr>
        <th>Producto</th>
        <th>Cantidad</th>
        <th>Precio Unitario</th>
        <th>Subtotal</th>
        <th>Acción</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <!-- Campos ocultos -->
  <div id="hidden-fields"></div>

</form>

{% if messages %}
<div id="django-messages" data-messages='[
  {% for message in messages %}
    "{{ message|escapejs }}"{% if not forloop.last %},{% endif %}
  {% endfor %}
]'></div>
{% endif %}

<!-- Select2 y JS -->
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<script src="{% static 'js/agregar_venta.js' %}"></script>
<script src="{% static 'js/mensajes.js' %}"></script>
{% endblock %}